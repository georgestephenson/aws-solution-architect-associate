# Amazon S3 Notes

- Main building blocks of AWS
- Advertised as "infinitely scaling"

## Use Cases

- Backup, storage
- Disaster recovery
- Archive
- Hybrid cloud storage
- App hosting
- Media hosting
- Data lakes
- Static website

## Buckets

- Store objects in buckets (directories)
- Globally unique name
- Region specific, though looks global
- Naming convention is lowercase letters, numbers and hyphens

## Objects

- Objects have a key, the full path to object, which can look like directories, but it's just a key in a bucket
- Max size 5TB
- If uploading more than 5GB, must use multi-part upload

## Security

- User-based IAM policies restrict API calls to S3
- Bucket policies - resource-based bucket-wide policies, most common
- Object Access Control List (ACL) - fine grain
- Bucket Access Control List (ACL) - less common

### Bucket Policies

- JSON based policies
  - Resource: bucket/object
  - Effect: allow/deny
  - Actions: APIs to control
  - Principal: account/user

### Block Public Access

- Overriding settings to prevent company data leaks
- Will override even if you set public access with bucket policy

## Static Website Hosting

- Can set your bucket to be a static website with a website URL
- Must set bucket to be publicly accessible, in same way as a non-website bucket

## Versioning

- Version files, enabled at bucket level

## Replication

- Cross-Region Replication (CRR)
- Same-Region Replication (SRR)
- Can be replication for buckets across AWS accounts
- Must give IAM permissions
- CRR - Compliance, lower latency, across accounts
- SRR - live replication between prod and test
- When enabled, only new objects are replicated
- S3 Batch Replication - optionally replicate existing objects
- Can replicate delete markers optionally, but permanent deletions not replicated
- No chaining of replication

## Storage Classes

- General Purpose
  - 99.99% availability
  - Low latency
  - Sustain 2 concurrent facility failures 
  - Use cases: Big Data, gaming and apps, content distribution
- Infrequent Access
  - Lower cost, for data less frequently accessed
  - Standard-Infrequent Access
    - Use cases: Disaster Recovery, backups
  - One Zone-Infrequent Access
    - One AZ, secondary backups
- Glacier classes
  - Glacier Instant Retrieval
    - Millisecond retrieval
    - Minimum storage duration of 90 days
  - Glacier Flexible Retrieval
    - Different options, Bulk 5 to 12 hours is free
    - Minimum storage duration of 90 days
  - Glacier Deep Archive
    - Longer term
    - Minimum storage duration of 180 days
  - Intelligent-Tiering
    - Small monthly fee, objects move automatically between tiers based on usage
- S3 Express One Zone
  - High Performance, single Availability Zone
  - Compute and Storage in same AZ, optimise performance
  - Use cases: latency/data-sensitive apps, AI/ML training

### Move between Storage Classes

- Down from Standard

### Lifecycle rules

- Transition Actions - move X time after creation
- Expiration Actions - delete after X days
- S3 Analytics - recommends for Standard or Standard IA what lifecycle rules you should have for transitioning

## Requester Pays

- Requester pays instead of bucket owner - owner stills pays storage cost, but requester pays networking cost
- Must be user within AWS (not anonymous)

## Event Notifications

- S3:ObjectCreated, S3:Replication, etc.
- Can use name filtering like *.jpg
- E.g. generate thumbnails of image uploaded to S3
- S3 can push to SNS "publish", SQS "send message", Lambda "invoke function"
- Use IAM policies to allow S3 to do that

### Amazon EventBridge

- Can send event to lots of AWS services
- Advanced filtering options
- Multiple destinations at once

## S3 Performance 

- 3,500 PUT/COPY/POST/DELETE request or 5,500 GET/HEAD requests per second per prefix per bucket
- (prefix is same as directories in buckets)
- No limit to number of prefixes
- Multi-Part Upload, recommended for >100MB, must use for >5GB
  - Can parallel upload of parts of file
- Transfer Acceleration - transfer file to AWS edge location, to forward to S3 bucket
  - Compatible with multi-part upload
  - Edge location can use private AWS network which is faster
- Byte-Range Fetches - request specific byte range of file, can parallelize request with these ranges, or request only part of file faster

## Batch Operations

- Bulk operations with single request
- Modify many objects metadata
- Copy many objects
- Encrypt many objects
- Invoke Lambda function on many objects
- Provides extra management and resiliency operations, rather than writing script to do bulk operations on objects
- S3 Inventory to get object list, Athena to query and filter objects

## S3 Storage Lengs

- Analyse, optimise storage across AWS organisation
- Discover anamolies, cost efficiencies, data protection best practices
- Aggregate data across org, dashboards, reports
- Default dashboard - common filters and metrics
- Cost-optimization metrics
- Data protection metrics
- Free metrics and paid advanced metrics